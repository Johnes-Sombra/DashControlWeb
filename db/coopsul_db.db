CREATE DATABASE coopsul_db;

-- Tabela de Cooperados
CREATE TABLE cooperados (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cpf VARCHAR(14) UNIQUE NOT NULL,
    data_nascimento DATE NOT NULL,
    endereco TEXT NOT NULL,
    bairro VARCHAR(50),
    cidade VARCHAR(50) NOT NULL,
    estado CHAR(2) NOT NULL,
    cep VARCHAR(9),
    telefone VARCHAR(15),
    email VARCHAR(100),
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ativo BOOLEAN DEFAULT true
);

-- Tabela de Empresas
CREATE TABLE empresas (
    id SERIAL PRIMARY KEY,
    razao_social VARCHAR(150) NOT NULL,
    nome_fantasia VARCHAR(150),
    cnpj VARCHAR(18) UNIQUE NOT NULL,
    endereco TEXT NOT NULL,
    bairro VARCHAR(50),
    cidade VARCHAR(50) NOT NULL,
    estado CHAR(2) NOT NULL,
    cep VARCHAR(9),
    telefone VARCHAR(15),
    email VARCHAR(100),
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ativo BOOLEAN DEFAULT true
);

-- Tabela de Veículos
CREATE TABLE veiculos (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    placa VARCHAR(8) UNIQUE NOT NULL,
    proprietario_id INTEGER,
    tipo_proprietario VARCHAR(20) CHECK (tipo_proprietario IN ('cooperado', 'empresa', 'terceiro')),
    empresa_id INTEGER,
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ativo BOOLEAN DEFAULT true,
    FOREIGN KEY (proprietario_id) REFERENCES cooperados(id),
    FOREIGN KEY (empresa_id) REFERENCES empresas(id)
);

-- Tabela de Tipos de Materiais
CREATE TABLE tipos_materiais (
    id SERIAL PRIMARY KEY,
    nome VARCHAR(50) NOT NULL,
    unidade_medida VARCHAR(10) NOT NULL,
    descricao TEXT
);

-- Inserir tipos de materiais padrão
INSERT INTO tipos_materiais (nome, unidade_medida) VALUES
    ('Papel', 'kg'),
    ('Papelão', 'kg'),
    ('Plástico', 'kg'),
    ('Vidro', 'kg'),
    ('Metal', 'kg'),
    ('Alumínio', 'kg'),
    ('Ferro', 'kg'),
    ('Eletrônico', 'kg'),
    ('Madeira', 'm²');

-- Tabela de Coletas
CREATE TABLE coletas (
    id SERIAL PRIMARY KEY,
    data_coleta TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    empresa_origem_id INTEGER NOT NULL,
    veiculo_id INTEGER NOT NULL,
    responsavel_id INTEGER NOT NULL,
    observacoes TEXT,
    FOREIGN KEY (empresa_origem_id) REFERENCES empresas(id),
    FOREIGN KEY (veiculo_id) REFERENCES veiculos(id),
    FOREIGN KEY (responsavel_id) REFERENCES cooperados(id)
);

-- Tabela de Materiais Coletados (relacionamento entre coleta e materiais)
CREATE TABLE materiais_coletados (
    id SERIAL PRIMARY KEY,
    coleta_id INTEGER NOT NULL,
    tipo_material_id INTEGER NOT NULL,
    quantidade DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (coleta_id) REFERENCES coletas(id),
    FOREIGN KEY (tipo_material_id) REFERENCES tipos_materiais(id)
);

-- Índices para melhor performance
CREATE INDEX idx_coletas_data ON coletas(data_coleta);
CREATE INDEX idx_coletas_empresa ON coletas(empresa_origem_id);
CREATE INDEX idx_materiais_coleta ON materiais_coletados(coleta_id);